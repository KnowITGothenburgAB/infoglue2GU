<?xml version="1.0" encoding="UTF-8"?> 

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

#if($colorScheme == "ManagementTool")
	#beginManagementTool("tool.contenttool.accessRights.header" "tool.contenttool.accessRights.header" "null")
#elseif($colorScheme == "StructureTool")
	#beginStructureTool("tool.contenttool.accessRights.header" "tool.contenttool.accessRights.header" "null" "null" "null" "null")
#elseif($colorScheme == "PublishingTool")
	#beginPublishingTool("tool.contenttool.accessRights.header" "tool.contenttool.accessRights.header" "null" "null" "null" "null")
#else
	#beginContentTool("tool.contenttool.accessRights.header" "tool.contenttool.accessRights.header" "null" "null" "null" "null")
#end

<div class="fullymarginalized">
<form method="POST" name="editForm" action="UpdateAccessRights.action">
<input type="hidden" name="interceptionPointCategory" value="$interceptionPointCategory">
<input type="hidden" name="parameters" value="$extraParameters">
<input type="hidden" name="returnAddress" value="$returnAddress">

#set($interceptionPointIndex = 0)
#foreach($interceptionPointVO in $interceptionPointVOList)
	#set($accessRightId = -1)
	#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
	
	#if($accessRightId > -1)
		#set($accessRightGroupIndex = 0)
		#foreach($accessRightGroup in $this.getAccessRightGroups($accessRightId))
			<input type="hidden" name="${interceptionPointVO.id}_${accessRightGroupIndex}_groupName" value="$accessRightGroup.groupName">
			#set($accessRightGroupIndex = $accessRightGroupIndex + 1)
		#end
	#end
	#set($interceptionPointIndex = $interceptionPointIndex + 1)
#end

<table border="0" width="95%" cellpadding="0" cellspacing="0">
	<tr class="darkgreen">
		<td class="smalllabel">Role</td>
		<td><img src="images/trans.gif" width="20" height="1"></td>
		#set($colspan = 1)
		#foreach($interceptionPointVO in $interceptionPointVOList)
			#if(($interceptionPointVO.getUsesExtraDataForAccessControl() && $extraParameters && $extraParameters != "") || (!$interceptionPointVO.getUsesExtraDataForAccessControl() && (!$extraParameters || $extraParameters == "")))
				#set($accessRightId = -1)
				#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
				#set($dotIndex = $interceptionPointVO.name.indexOf(".") + 1)
				<td align="center" class="smalllabel">$interceptionPointVO.name.substring($dotIndex)
				#if($accessRightId > -1)
					#set($accessRightGroups = $this.getAccessRightGroups($accessRightId))
					#if($accessRightGroups.size() > 0)
						<a href="javascript:showDiv('groups$accessRightId');" title="Limited by groups also - click to view."><img src="images/groups.gif" border="0"/></a>
					#else
						<a href="javascript:showDiv('groups$accessRightId');" title="Not limited by groups at the moment"><img src="images/groupsInactive.gif" border="0"/></a>
					#end
				#end
				</td>
				<td><img src="images/trans.gif" width="20" height="1"></td>
				#set($colspan = $colspan + 3)
			#end
		#end
	</tr>
	
	<tr>
		<td bgcolor="#EEF7DC" colspan="$colspan" height="1"><img src="images/trans.gif" width="1" height="1"></td>
	</tr>
	<tr>
		<td bgcolor="#C7D1B3" colspan="$colspan" height="1"><img src="images/trans.gif" width="1" height="1"></td>
	</tr>
	
	#set($roleIndex = 0)
	#foreach ($role in $roleList)
		<tr>
			<td>
				$role.name
				<input type="hidden" name="${roleIndex}_roleName" value="$role.name">
			</td>
			<td></td>
			#set($interceptionPointIndex = 0)
			#foreach($interceptionPointVO in $interceptionPointVOList)
				#if(($interceptionPointVO.getUsesExtraDataForAccessControl() && $extraParameters && $extraParameters != "") || (!$interceptionPointVO.getUsesExtraDataForAccessControl() && (!$extraParameters || $extraParameters == "")))
					<td align="center" nowrap>
						#set($checked = "")
						#if($this.getHasAccessRight($interceptionPointVO.id, $extraParameters, $role.name))
							#set($checked = "checked")
							#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
						#end 
						
						<input type="hidden" name="${interceptionPointIndex}_InterceptionPointId" value="$interceptionPointVO.id">
						<input type="hidden" name="${interceptionPointVO.id}_${roleIndex}_roleName" value="$role.name">
						<input type="checkbox" name="${interceptionPointVO.id}_${role.name}_hasAccess" value="true" $checked>
						
					</td>
					<td></td>
					#set($interceptionPointIndex = $interceptionPointIndex + 1)
				#end
			#end
		</tr>
		#set($roleIndex = $roleIndex + 1)
	#end
	
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr>	
		<td colspan="$interceptionPointIndex">
			<a href="javascript:document.editForm.submit();"><image src="$ui.getString("images.managementtool.buttons.save")" width="50" height="25" border="0"></a>
			<!--<a href="javascript:saveAndExit(document.editForm, 'UpdateAccessRights!saveAndExit.action');"><img src="$ui.getString("images.managementtool.buttons.saveAndExit")" width="80" height="25" border="0"></a>-->
			<a href="$returnAddress"><img border="0" src="$ui.getString("images.managementtool.buttons.cancel")" width="50" height="25"></a>
		</td>
	</tr>			
	
</table>
</form>
</div>


#*
<div class="fullymarginalized">
<form method="POST" name="addUserForm" action="UpdateAccessRights!addUserRights.action">
<input type="hidden" name="interceptionPointCategory" value="$interceptionPointCategory">
<input type="hidden" name="parameters" value="$extraParameters">
<input type="hidden" name="returnAddress" value="$returnAddress">

<table border="0" width="95%" cellpadding="0" cellspacing="0">
	<tr class="darkgreen">
		<td class="smalllabel">Individual users with access</td>
		<td><img src="images/trans.gif" width="20" height="1"></td>
		#set($colspan = 1)
		#foreach($interceptionPointVO in $interceptionPointVOList)
			#set($accessRightId = -1)
			#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
			#set($dotIndex = $interceptionPointVO.name.indexOf(".") + 1)
			<td align="center" class="smalllabel">$interceptionPointVO.name.substring($dotIndex)</td>
			<td><img src="images/trans.gif" width="20" height="1"></td>
			#set($colspan = $colspan + 3)
		#end
	</tr>
	
	<tr>
		<td bgcolor="#EEF7DC" colspan="$colspan" height="1"><img src="images/trans.gif" width="1" height="1"></td>
	</tr>
	<tr>
		<td bgcolor="#C7D1B3" colspan="$colspan" height="1"><img src="images/trans.gif" width="1" height="1"></td>
	</tr>
	#foreach($principal in $principals)
	<tr>
		<td>
			$principal.userName
		</td>
		<td></td>
		#set($interceptionPointIndex = 0)
		#foreach($interceptionPointVO in $interceptionPointVOList)
			<td align="center" nowrap>
				#set($checked = "")
				#if($this.getHasAccessRight($interceptionPointVO.id, $extraParameters, $role.name))
					#set($checked = "checked")
					#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
				#end 
				
				<input type="hidden" name="${interceptionPointIndex}_InterceptionPointId" value="$interceptionPointVO.id">
				<input type="hidden" name="${interceptionPointVO.id}_${roleIndex}_roleName" value="$role.name">
				<input type="checkbox" name="${interceptionPointVO.id}_${role.name}_hasAccess" value="true" $checked>
				
			</td>
			<td></td>
			#set($interceptionPointIndex = $interceptionPointIndex + 1)
		#end
	</tr>
	#end	

	<tr>
		<td>
			<input type="textfield" name="userName" value="">
		</td>
		<td></td>
		#set($interceptionPointIndex = 0)
		#foreach($interceptionPointVO in $interceptionPointVOList)
			<td align="center" nowrap>
				#set($checked = "")
				#if($this.getHasAccessRight($interceptionPointVO.id, $extraParameters, $role.name))
					#set($checked = "checked")
					#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
				#end 
				
				<input type="hidden" name="interceptionPointId" value="$interceptionPointVO.id">
				<input type="checkbox" name="${interceptionPointVO.id}_hasAccess" value="true" $checked>
				
			</td>
			<td></td>
			#set($interceptionPointIndex = $interceptionPointIndex + 1)
		#end
	</tr>
	
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr>	
		<td colspan="$interceptionPointIndex">
			<a href="javascript:document.addUserForm.submit();"><image src="$ui.getString("images.contenttool.buttons.addButton")" width="50" height="25" border="0"></a>
		</td>
	</tr>			
*#
	
</table>
</form>
</div>


<script type="text/javascript">

	function showDiv(id)
	{
		document.getElementById(id).style.visibility = 'visible';
	}
	
	function hideDiv(id)
	{
		document.getElementById(id).style.visibility = 'hidden';
	}
	
</script>
						
#set($interceptionPointIndex = 0)
#foreach($interceptionPointVO in $interceptionPointVOList)
	#set($accessRightId = -1)
	#set($accessRightId = $this.getAccessRightId($interceptionPointVO.id, $extraParameters))
	#if($accessRightId > -1)
		#set($accessRightGroups = $this.getAccessRightGroups($accessRightId))
	<div id="groups$accessRightId" style="position: absolute; overflow: auto; top: 10px; left: 150px; visibility: hidden; width:400px; height:500px; background-color: white; border:1px solid black;">
		<form method="POST" name="groups${accessRightId}Form" action="UpdateAccessRights!addGroups.action">
		<input type="hidden" name="interceptionPointCategory" value="$interceptionPointCategory">
		<input type="hidden" name="parameters" value="$extraParameters">
		<input type="hidden" name="accessRightId" value="$accessRightId">
		<input type="hidden" name="returnAddress" value="$returnAddress">
		
		<table width="100%" bgcolor="white" cellpadding="0" cellspacing="0" border="0">
		<tr class="darkgreen">
			<td class="smalllabel">&nbsp;</td>
			<td class="smalllabel" width="90%">Group</td>
		</tr>
		<tr>
			<td bgcolor="#EEF7DC" colspan="2" height="1"><img src="images/trans.gif" width="1" height="1"></td>
		</tr>
		<tr>
			<td bgcolor="#C7D1B3" colspan="2" height="1"><img src="images/trans.gif" width="1" height="1"></td>
		</tr>
		
		#foreach($group in $groupList)
		
			#set($selected = "")
			#foreach($accessRightGroup in $accessRightGroups)
				#if($accessRightGroup.groupName == $group.name)
					#set($selected = "checked='1'")
				#end
			#end
		<tr>
		  	<td><input type="checkbox" name="groupName" value="${group.name}" $selected></td>
		  	<td>$group.name</td>
		</tr>
		#end
		<tr>
		  	<td colspan="2">&nbsp;</td>
		</tr>
		<tr>
		  	<td colspan="2">
		  	<a href="javascript:document.groups${accessRightId}Form.submit();"><image src="$ui.getString("images.managementtool.buttons.save")" width="50" height="25" border="0"></a>
		  	<img border="0" src="$ui.getString("images.contenttool.buttons.close")" width="50" height="25" onclick="hideDiv('groups$accessRightId');">
		  	</td>
		</tr>
		</table>
		</form>
	</div>			
	#end
	#set($interceptionPointIndex = $interceptionPointIndex + 1)
#end
	

	
</body>
</html>
