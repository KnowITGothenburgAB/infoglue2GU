<?xml version="1.0" encoding="UTF-8"?> 

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

#beginManagementTool("tool.managementtool.deployment.header" "tool.managementtool.deployment.header" "")

<script type="text/javascript" src="script/jsdiff.js"></script>
<script type="text/javascript">
<!--
	function showDiff(compId)
	{
		var element = document.getElementById(compId);
		if(element.style.display == "none")
			element.style.display = "block";
		else
			element.style.display = "none";
	}
	
	var previousTabId = "contentTypeDefinitions";
	var previousLiTabId = "contentTypeDefinitionsTab";
	
	function activateTab(tabId)
	{
		//alert("previousTabId:" + previousTabId);
		var previousLiTabElement = document.getElementById(previousTabId);
		var previousLiTabTabElement = document.getElementById(previousTabId + "Tab");
		if(previousLiTabElement)
			previousLiTabElement.style.display = "none";
		if(previousLiTabTabElement)
			previousLiTabTabElement.className = "";

		var newLiTabElement = document.getElementById(tabId);
		var newLiTabTabElement = document.getElementById(tabId + "Tab");
		if(newLiTabElement)
			newLiTabElement.style.display = "block";
		if(newLiTabTabElement)
			newLiTabTabElement.className = "activeTab";
					
		previousTabId = tabId;
		previousLiTabId = tabId + "Tab";
	}
	
	var activateTabId = "undefined";
-->
</script>

<style>
<!--
	ins 
	{
	  background-color: #ccffcc;
	}
	
	del 
	{
	  background-color: #ff6666;
	}
	
	input
	{
		background: white;
		border: 1px solid #cccccc;
		font-family: Verdana, Arial, San serif;
		font-size: 8pt;
	}

	.entitiesTabs
	{
		margin: 0;	
		padding-left: 10px;
		clear: both;
		overflow: auto;
	}
	
	.entitiesTabs li
	{
		margin: 0; 
		padding: 0;
		display: inline;	
		list-style-type: none;
	}

	.entitiesTabs a:link, .entitiesTabs a:visited {	
		float: left;
		background: #f3f3f3;
		font-size: 10px;	
		line-height: 14px;	
		padding: 2px 10px 2px 10px;
		margin-right: 4px;	
		border: 1px solid #ccc;	
		border-bottom: 0px solid white;
		text-decoration: none;	
		color: #666;
	}

	.entitiesTabs a:link.active, .entitiesTabs a:visited.active {
		border-bottom: 1px solid #fff;
		background: #fff;	
		color: #000;
	}
	
	.entitiesTabs a:hover	{
		background: #fff;
	}
	
	.activeTab {
		color: #000;
		font-weight: bold;
	}

	.activeTab a:link, .activeTab a:link.visited {
		color: #000;
		font-weight: bold;
	}

	.tabs
	{
		display: block;
	}
	
	.tab
	{
		display: none;
		padding: 8px;
		border: 1px solid #ccc;
	}
	
-->
</style>

<div class="fullymarginalized">
<h2>$ui.getString("tool.managementtool.deployment.chooseEntitiesHeader")</h2>
<p>$ui.getString("tool.managementtool.deployment.chooseEntitiesIntroduction")</p>

<ul class="entitiesTabs">
	#if($synchronizeContentTypeDefinitions)
	<li id="contentTypeDefinitionsTab" class="activeTab"><a href="javascript:activateTab('contentTypeDefinitions');">$ui.getString("tool.managementtool.deployment.contentTypeDefinitions.label")</a></li>
	#end
	#if($synchronizeCategories)
	<li id="categoriesTab" class=""><a href="javascript:activateTab('categories');">$ui.getString("tool.managementtool.deployment.categories.label")</a></li>
	#end
	#if($synchronizeWorkflows)
	<li id="workflowsTab" class=""><a href="javascript:activateTab('workflows');">$ui.getString("tool.managementtool.deployment.workflows.label")</a></li>
	#end
	#if($synchronizeComponents)
	<li id="componentsTab" class=""><a href="javascript:activateTab('components');">$ui.getString("tool.managementtool.deployment.components.label")</a></li>
	#end
</ul>
<div style="clear: both;"/>

<div class="tabs">
	#if($synchronizeContentTypeDefinitions)
		<div class="tab" id="contentTypeDefinitions" style="display: block;">

		<form name="contentTypesForm" action="ViewDeploymentSynchronizeServers!updateContentTypes.action" method="post">
			<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
			<input type="hidden" name="synchronizationMethod" value="$synchronizationMethod"/>		
		
			<h3>Content types that deviates</h3>
			#set($indexMissingTypes = 0)
			#foreach($deviatingContentType in $deviatingContentTypes)
				#if((!$deviatingContentType.localVersion && $synchronizationMethod == 'pull') || (!$deviatingContentType.remoteVersion && $synchronizationMethod == 'push'))
					#if($synchronizationMethod == 'pull')
						<input type="checkbox" name="missingContentTypeName" value="$deviatingContentType.remoteVersion.name"/> No local version of $deviatingContentType.remoteVersion.name <a href="javascript:showDiff('$deviatingContentType.remoteVersion.name');">diff</a><br/> 
					
						#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!deviatingContentType.remoteVersion.schemaValue, 'iglb'))")
						#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings('', 'iglb'))")
						
						<script type="text/javascript">
						<!--
						var value1 = "$value1";
						var value2 = "$value2";
						value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						
						document.write("<div id='$deviatingContentType.remoteVersion.name' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px; height: 200px; overflow: auto;'>" + diffString(value2, value1) + "</div>");
						-->
						</script>
					#else
						<input type="checkbox" name="missingContentTypeName" value="$deviatingContentType.localVersion.name"/> No remote version of $deviatingContentType.localVersion.name <a href="javascript:showDiff('$deviatingContentType.localVersion.name');">diff</a><br/> 
						
						#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!deviatingContentType.localVersion.schemaValue, 'iglb'))")
						#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings('', 'iglb'))")
						
						<script type="text/javascript">
						<!--
						var value1 = "$value1";
						var value2 = "$value2";
						value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						
						document.write("<div id='$deviatingContentType.localVersion.name' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px; height: 200px; overflow: auto;'>" + diffString(value2, value1) + "</div>");
						-->
						</script>
					#end			
				#else
					#set($value1 = "$!formatter.escapeExtendedHTML($formatter.cleanForJavascriptStrings($deviatingContentType.remoteVersion.schemaValue, 'iglb'))")
					#set($value2 = "$!formatter.escapeExtendedHTML($formatter.cleanForJavascriptStrings($deviatingContentType.localVersion.schemaValue, 'iglb'))")
	
					#if($value1 != $value2)
						#if($synchronizationMethod == 'pull')
							<input type="checkbox" id="deviatedContentTypeName_$deviatingContentType.remoteVersion.name" name="deviatedContentTypeName" value="$deviatingContentType.remoteVersion.name"/> $deviatingContentType.remoteVersion.name <a href="javascript:showDiff('$deviatingContentType.remoteVersion.name');">diff</a><br/> 
						#else
							<input type="checkbox" id="deviatedContentTypeName_$deviatingContentType.remoteVersion.name" name="deviatedContentTypeName" value="$deviatingContentType.localVersion.name"/> $deviatingContentType.localVersion.name <a href="javascript:showDiff('$deviatingContentType.localVersion.name');">diff</a><br/> 
						#end
						<script type="text/javascript">
						<!--
						var value1 = "#if($synchronizationMethod == 'pull')$value1#else$value2#end";
						var value2 = "#if($synchronizationMethod == 'pull')$value2#else$value1#end";
						value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						
						document.write("<div id='$deviatingContentType.remoteVersion.name' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px; height: 200px; overflow: auto;'>" + diffString(value2, value1) + "</div>");
						-->
						</script>
	
						<ul style="padding-left: 50px;">
						<li class="normalitemhead"><strong>Missing #if($synchronizationMethod == 'pull')local #else remote#end attributes</strong></li>
						#if($synchronizationMethod == 'pull')
							#set($deviatingAttributes = $this.getDeviatingAttributes($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#else
							#set($deviatingAttributes = $this.getDeviatingAttributes($deviatingContentType.localVersion.schemaValue, $deviatingContentType.remoteVersion.schemaValue))
						#end
						#foreach($deviatingAttribute in $deviatingAttributes)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_attributeName" value="$deviatingAttribute.name"/> $deviatingAttribute.name
							</li>
						#end
						#if($deviatingAttributes.size() == 0)
							<li class="normalitem">No missing #if($synchronizationMethod == 'pull')local #else remote#end attributes</li>
						#end
	
						<li class="normalitemhead"><strong>Missing #if($synchronizationMethod == 'pull')local #else remote#end categories</strong></li>
						#if($synchronizationMethod == 'pull')
							#set($deviatingCategories = $this.getDeviatingCategories($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#else
							#set($deviatingCategories = $this.getDeviatingCategories($deviatingContentType.localVersion.schemaValue, $deviatingContentType.remoteVersion.schemaValue))
						#end
						#foreach($deviatingCategory in $deviatingCategories)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_categoryName" value="$deviatingCategory.value"/> $deviatingCategory.value
							</li>
						#end
						#if($deviatingCategories.size() == 0)
							<li class="normalitem">No missing #if($synchronizationMethod == 'pull')local #else remote#end categories</li>
						#end
	
						<li class="normalitemhead"><strong>Missing #if($synchronizationMethod == 'pull')local #else remote#end asset keys</strong></li>
						#if($synchronizationMethod == 'pull')
							#set($deviatingAssetKeys = $this.getDeviatingAssetKeys($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#else
							#set($deviatingAssetKeys = $this.getDeviatingAssetKeys($deviatingContentType.localVersion.schemaValue, $deviatingContentType.remoteVersion.schemaValue))
						#end
						#foreach($deviatingAssetKey in $deviatingAssetKeys)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_assetKey" value="$deviatingAssetKey.assetKey"/> $deviatingAssetKey.assetKey
							</li>
						#end
						#if($deviatingAssetKeys.size() == 0)
							<li class="normalitem">No missing #if($synchronizationMethod == 'pull')local #else remote#end asset keys</li>
						#end
						
						#if($deviatingAttributes.size() == 0 && $deviatingCategories.size() == 0 && $deviatingAssetKeys.size() == 0)
							<script type="text/javascript">
							<!--
								document.getElementById("deviatedContentTypeName_$deviatingContentType.remoteVersion.name").disabled = true;
							-->
							</script>
						#end
						
						</ul>
					#else
						##Exakt compare: $deviatingContentType.remoteVersion.name<br/> 
					#end
				#end
	
				#set($indexMissingTypes = $indexMissingTypes + 1)
			#end
			<br/>
			<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
		</form>
		<script type="text/javascript">
			if(activateTabId == "undefined")
				activateTabId = "contentTypeDefinitions";
		</script>
	</div>
	#end
	
	#if($synchronizeCategories)
		<div class="tab" id="categories">
		
			<form name="categoriesForm" action="ViewDeploymentSynchronizeServers!updateCategories.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
				<input type="hidden" name="synchronizationMethod" value="$synchronizationMethod"/>		
			
				<h3>Categories that deviates</h3>
				<ul>
				#set($indexMissingCategories = 0)
				#foreach($deviatingCategory in $deviatingCategoryVOList)
					#if($synchronizationMethod == 'pull')
						#if(!$deviatingCategory.localVersion)
							<input type="checkbox" name="${deviatingCategory.remoteVersion.categoryPath}_transfer" value="true"/> Missing local version of $deviatingCategory.remoteVersion.name ($deviatingCategory.remoteVersion.categoryPath)<br/> 
						#end
			
						#set($indexMissingCategories = $indexMissingCategories + 1)
					#else
						#if(!$deviatingCategory.remoteVersion)
							<input type="checkbox" name="${deviatingCategory.localVersion.categoryPath}_transfer" value="true"/> Missing remote version of $deviatingCategory.localVersion.name ($deviatingCategory.localVersion.categoryPath)<br/> 
						#end
			
						#set($indexMissingCategories = $indexMissingCategories + 1)
					#end
				#end
				#if($deviatingCategoryVOList.size() == 0)
					<li class="normalitem">No missing categories</li>
				#end
				</ul>
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
			<script type="text/javascript">
				if(activateTabId == "undefined")
					activateTabId = "categories";
			</script>		
		</div>
	#end
	

	#if($synchronizeWorkflows)	
		<div class="tab" id="workflows">
			<form name="workflowsForm" action="ViewDeploymentSynchronizeServers!updateWorkflows.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
				<input type="hidden" name="synchronizationMethod" value="$synchronizationMethod"/>		
			
				<h3>Workflows that deviates</h3>
				<ul>
				#set($indexMissingWorkflows = 0)
				#foreach($deviatingWorkflow in $deviatingWorkflows)
					#if($synchronizationMethod == 'pull')
						#if(!$deviatingWorkflow.localVersion)
							<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.remoteVersion.name"/> Missing local version of $deviatingWorkflow.remoteVersion.name<br/> 
							#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
						#else
							#set($value1 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.remoteVersion.value)")
							#set($value2 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.localVersion.value)")
			
							#if($value1 != $value2)
								<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.remoteVersion.name"/> $deviatingWorkflow.remoteVersion.name is different in local system<br/> 
								#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
							#else
								##Exakt compare: $deviatingWorkflow.remoteVersion.name<br/> 
							#end
						#end
					#else
						#if(!$deviatingWorkflow.remoteVersion)
							<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.localVersion.name"/> Missing remote version of $deviatingWorkflow.localVersion.name<br/> 
							#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
						#else
							#set($value1 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.remoteVersion.value)")
							#set($value2 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.localVersion.value)")
			
							#if($value1 != $value2)
								<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.localVersion.name"/> $deviatingWorkflow.localVersion.name is different in remote system<br/> 
								#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
							#else
								##Exakt compare: $deviatingWorkflow.localVersion.name<br/> 
							#end
						#end		
					#end
				#end
				#if($indexMissingWorkflows == 0)
					<li class="normalitem">No missing workflows</li>
				#end
				</ul>
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
			<script type="text/javascript">
				if(activateTabId == "undefined")
					activateTabId = "workflows";
			</script>		
		</div>
	#end
	

	#if($synchronizeComponents)
		<div class="tab" id="components">
			<form name="contentsForm" action="ViewDeploymentSynchronizeServers!updateComponents.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
				<input type="hidden" name="synchronizationMethod" value="$synchronizationMethod"/>		
			
				<h3>Components that deviates</h3>
				#set($indexMissingContents = 0)
				#foreach($deviatingContent in $deviatingContents)
					#if($synchronizationMethod == 'pull')
						#if(!$deviatingContent.localVersion)
							<input type="checkbox" name="missingContentId" value="$deviatingContent.remoteVersion.id"/> Missing local version of $deviatingContent.remoteVersion.name ($deviatingContent.remoteVersion.fullPath)<br/> 
						#else
							#set($remoteVersions = $!converter.getListFromArray($!deviatingContent.remoteVersion.versions))
							#set($localVersions = $!converter.getListFromArray($!deviatingContent.localVersion.versions))
							
							#if($remoteVersions.size() > 0)
								#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!remoteVersions.get(0), 'iglb'))")
							#else
								#set($value1 = "")
							#end
							
							#if($localVersions.size() > 0)
								#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($localVersions.get(0), 'iglb'))")
							#else
								#set($value2 = "")
							#end
							
							#if("$value1" != "$value2")
								<input type="checkbox" name="deviatingContentId" value="$deviatingContent.remoteVersion.id"/> $deviatingContent.remoteVersion.name - <a href="javascript:showDiff($deviatingContent.remoteVersion.id);">diff</a><br/>
								<script type="text/javascript">
								<!--
								var value1 = "$value1";
								var value2 = "$value2";
								value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
								value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
								
								document.write("<div id='$deviatingContent.remoteVersion.id' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px; height: 200px; overflow: auto;'>" + diffString(value2, value1) + "</div>");
								-->
								</script>
							#else
								##Exakt compare: $deviatingContent.remoteVersion.name<br/> 
							#end
						#end
					#else
						#if(!$deviatingContent.remoteVersion)
							<input type="checkbox" name="missingContentId" value="$deviatingContent.localVersion.id"/> Missing remote version of $deviatingContent.localVersion.name ($deviatingContent.localVersion.fullPath)<br/> 
						#else
							#set($remoteVersions = $!converter.getListFromArray($!deviatingContent.remoteVersion.versions))
							#set($localVersions = $!converter.getListFromArray($!deviatingContent.localVersion.versions))
							
							#if($remoteVersions.size() > 0)
								#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!remoteVersions.get(0), 'iglb'))")
							#else
								#set($value1 = "")
							#end
							
							#if($localVersions.size() > 0)
								#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($localVersions.get(0), 'iglb'))")
							#else
								#set($value2 = "")
							#end
							
							#if("$value1" != "$value2")
								<input type="checkbox" name="deviatingContentId" value="$deviatingContent.localVersion.id"/> $deviatingContent.localVersion.name - <a href="javascript:showDiff($deviatingContent.localVersion.id);">diff</a><br/>
								<script type="text/javascript">
								<!--
								var value1 = "$value2";
								var value2 = "$value1";
								value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
								value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
								
								document.write("<div id='$deviatingContent.localVersion.id' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px; height: 200px; overflow: auto;'>" + diffString(value2, value1) + "</div>");
								-->
								</script>
							#else
								##Exakt compare: $deviatingContent.localVersion.name<br/> 
							#end
						#end	
					#end
					
					#set($indexMissingContents = $indexMissingContents + 1)
				#end
				#if($deviatingContents.size() == 0)
					<li class="normalitem">No missing contents</li>
				#end
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
			<script type="text/javascript">
				if(activateTabId == "undefined")
					activateTabId = "components";
			</script>		
		</div>
	#end
</div>
<p/>	
</div>
<script type="text/javascript">
	var previousTabId = activateTabId;
	var previousLiTabId = activateTabId + "Tab";	
	activateTab(activateTabId);
</script>		
</body>
</html>
