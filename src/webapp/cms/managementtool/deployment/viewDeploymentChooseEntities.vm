<?xml version="1.0" encoding="UTF-8"?> 

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

#beginManagementTool("tool.managementtool.deployment.header" "tool.managementtool.deployment.header" "")

<script type="text/javascript" src="script/jsdiff.js"></script>
<script type="text/javascript">
<!--
	function showDiff(compId)
	{
		var element = document.getElementById(compId);
		if(element.style.display == "none")
			element.style.display = "block";
		else
			element.style.display = "none";
	}
	
	var previousTabId = "contentTypeDefinitions";
	var previousLiTabId = "contentTypeDefinitionsTab";
	
	function activateTab(tabId)
	{
		document.getElementById(previousTabId).style.display = "none";
		document.getElementById(tabId).style.display = "block";
	
		document.getElementById(previousLiTabId).className = "";
		document.getElementById(tabId + "Tab").className = "activeTab";
					
		previousTabId = tabId;
		previousLiTabId = tabId + "Tab";
	}
-->
</script>

<style>
<!--
	ins 
	{
	  background-color: #ccffcc;
	}
	
	del 
	{
	  background-color: #ff6666;
	}
	
	input
	{
		background: white;
		border: 1px solid #cccccc;
		font-family: Verdana, Arial, San serif;
		font-size: 8pt;
		awidth: 200px;
	}

	.entitiesTabs
	{
		margin: 0;	
		padding-left: 10px;
		aborder: 1px solid #ccc;
		abackground-color: white;
		clear: both;
		overflow: auto;
	}
	
	.entitiesTabs li
	{
		margin: 0; 
		padding: 0;
		display: inline;	
		list-style-type: none;
	}

	.entitiesTabs a:link, .entitiesTabs a:visited {	
		float: left;
		background: #f3f3f3;
		font-size: 10px;	
		line-height: 14px;	
		padding: 2px 10px 2px 10px;
		margin-right: 4px;	
		border: 1px solid #ccc;	
		border-bottom: 0px solid white;
		text-decoration: none;	
		color: #666;
	}

	.entitiesTabs a:link.active, .entitiesTabs a:visited.active {
		border-bottom: 1px solid #fff;
		background: #fff;	
		color: #000;
	}
	
	.entitiesTabs a:hover	{
		background: #fff;
	}
	
	.activeTab {
		color: #000;
		font-weight: bold;
	}

	.activeTab a:link, .activeTab a:link.visited {
		color: #000;
		font-weight: bold;
	}

	.tabs
	{
		display: block;
	}
	
	.tab
	{
		display: none;
		padding: 8px;
		border: 1px solid #ccc;
	}
	
-->
</style>

<div class="fullymarginalized">
<h2>$ui.getString("tool.managementtool.deployment.chooseEntitiesHeader")</h2>
<p>$ui.getString("tool.managementtool.deployment.chooseEntitiesIntroduction")</p>

<ul class="entitiesTabs">
	<li id="contentTypeDefinitionsTab" class="activeTab"><a href="javascript:activateTab('contentTypeDefinitions');">$ui.getString("tool.managementtool.deployment.contentTypeDefinitions.label")</a></li>
	<li id="categoriesTab" class=""><a href="javascript:activateTab('categories');">$ui.getString("tool.managementtool.deployment.categories.label")</a></li>
	<li id="workflowsTab" class=""><a href="javascript:activateTab('workflows');">$ui.getString("tool.managementtool.deployment.workflows.label")</a></li>
	<li id="componentsTab" class=""><a href="javascript:activateTab('components');">$ui.getString("tool.managementtool.deployment.components.label")</a></li>
</ul>
<div style="clear: both;"/>

<div class="tabs">
	<div class="tab" id="contentTypeDefinitions" style="display: block;">

		#if($synchronizeContentTypeDefinitions)
		<form name="contentTypesForm" action="ViewDeploymentSynchronizeServers!updateContentTypes.action" method="post">
			<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
		
			<h3>Content types that deviates</h3>
			#set($indexMissingTypes = 0)
			#foreach($deviatingContentType in $deviatingContentTypes)
				#if(!$deviatingContentType.localVersion)
					<input type="checkbox" name="missingContentTypeName" value="$deviatingContentType.remoteVersion.name"/> Missing local version of $deviatingContentType.remoteVersion.name <a href="javascript:showDiff('$deviatingContentType.remoteVersion.name');">diff</a><br/> 
	
					#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!deviatingContentType.remoteVersion.versionValue, 'iglb'))")
					#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings('', 'iglb'))")
					
					<script type="text/javascript">
					<!--
					var value1 = "$value1";
					var value2 = "$value2";
					value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
					value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
					
					document.write("<div id='$deviatingContentType.remoteVersion.name' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px;'>" + diffString(value2, value1) + "</div>");
					-->
					</script>
			
				#else
					#set($value1 = "$!formatter.escapeExtendedHTML($formatter.cleanForJavascriptStrings($deviatingContentType.remoteVersion.schemaValue, 'iglb'))")
					#set($value2 = "$!formatter.escapeExtendedHTML($formatter.cleanForJavascriptStrings($deviatingContentType.localVersion.schemaValue, 'iglb'))")
	
					#if($value1 != $value2)
						<input type="checkbox" name="deviatedContentTypeName" value="$deviatingContentType.remoteVersion.name"/> $deviatingContentType.remoteVersion.name <a href="javascript:showDiff('$deviatingContentType.remoteVersion.name');">diff</a><br/> 
						<script type="text/javascript">
						<!--
						var value1 = "$value1";
						var value2 = "$value2";
						value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
						
						document.write("<div id='$deviatingContentType.remoteVersion.name' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px;'>" + diffString(value2, value1) + "</div>");
						-->
						</script>
	
						<ul>
						<li class="normalitemhead"><strong>Attributes</strong></li>
						#set($deviatingAttributes = $this.getDeviatingAttributes($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#foreach($deviatingAttribute in $deviatingAttributes)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_attributeName" value="$deviatingAttribute.name"/> $deviatingAttribute.name
							</li>
						#end
						#if($deviatingAttributes.size() == 0)
							<li class="normalitem">No missing attributes</li>
						#end
	
						<li class="normalitemhead"><strong>Categories</strong></li>
						#set($deviatingCategories = $this.getDeviatingCategories($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#foreach($deviatingCategory in $deviatingCategories)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_categoryName" value="$deviatingCategory.value"/> $deviatingCategory.value
							</li>
						#end
						#if($deviatingCategories.size() == 0)
							<li class="normalitem">No missing categories</li>
						#end
	
						<li class="normalitemhead"><strong>Asset keys</strong></li>
						#set($deviatingAssetKeys = $this.getDeviatingAssetKeys($deviatingContentType.remoteVersion.schemaValue, $deviatingContentType.localVersion.schemaValue))
						#foreach($deviatingAssetKey in $deviatingAssetKeys)
							<li class="normalitem">
								<input type="checkbox" name="${deviatingContentType.remoteVersion.name}_assetKey" value="$deviatingAssetKey.assetKey"/> $deviatingAssetKey.assetKey
							</li>
						#end
						#if($deviatingAssetKeys.size() == 0)
							<li class="normalitem">No missing asset keys</li>
						#end
						
						</ul>
					#else
						##Exakt compare: $deviatingContentType.remoteVersion.name<br/> 
					#end
				#end
	
				#set($indexMissingTypes = $indexMissingTypes + 1)
			#end
			<br/>
			<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
		</form>
		#end
	</div>
	
	<div class="tab" id="categories">
		
		#if($synchronizeCategories)
			<form name="categoriesForm" action="ViewDeploymentSynchronizeServers!updateCategories.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
			
				<h3>Categories that deviates</h3>
				<ul>
				#set($indexMissingCategories = 0)
				#foreach($deviatingCategory in $deviatingCategoryVOList)
					#if(!$deviatingCategory.localVersion)
						$deviatingCategory.remoteVersion.categoryPath
						<input type="checkbox" name="${deviatingCategory.remoteVersion.categoryPath}_transfer" value="true"/> Missing local version of $deviatingCategory.remoteVersion.name<br/> 
					#end
		
					#set($indexMissingCategories = $indexMissingCategories + 1)
				#end
				#if($deviatingCategoryVOList.size() == 0)
					<li class="normalitem">No missing categories</li>
				#end
				</ul>
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
		#end

	</div>
	

	<div class="tab" id="workflows">
	
		#if($synchronizeWorkflows)	
			<form name="workflowsForm" action="ViewDeploymentSynchronizeServers!updateWorkflows.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
			
				<h3>Workflows that deviates</h3>
				<ul>
				#set($indexMissingWorkflows = 0)
				#foreach($deviatingWorkflow in $deviatingWorkflows)
					#if(!$deviatingWorkflow.localVersion)
						<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.remoteVersion.name"/> Missing local version of $deviatingWorkflow.remoteVersion.name<br/> 
						#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
					#else
						#set($value1 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.remoteVersion.value)")
						#set($value2 = "$formatter.cleanForJavascriptStrings($deviatingWorkflow.localVersion.value)")
		
						#if($value1 != $value2)
							<input type="checkbox" name="missingWorkflowDefinitionName" value="$deviatingWorkflow.remoteVersion.name"/> $deviatingWorkflow.remoteVersion.name<br/> 
							#set($indexMissingWorkflows = $indexMissingWorkflows + 1)
						#else
							##Exakt compare: $deviatingWorkflow.remoteVersion.name<br/> 
						#end
					#end
				#end
				#if($indexMissingWorkflows == 0)
					<li class="normalitem">No missing workflows</li>
				#end
				</ul>
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
		#end

	</div>
	

	<div class="tab" id="components">

		#if($synchronizeComponents)
			<form name="contentsForm" action="ViewDeploymentSynchronizeServers!updateContents.action" method="post">
				<input type="hidden" name="deploymentServerIndex" value="$deploymentServerIndex"/>
			
				<h3>Compoents that deviates</h3>
				#set($indexMissingContents = 0)
				#foreach($deviatingContent in $deviatingContents)
					#if(!$deviatingContent.localVersion)
						<input type="checkbox" name="missingContentId" value="$deviatingContent.remoteVersion.name"/> Missing local version of $deviatingContent.remoteVersion.name ($deviatingContent.remoteVersion.fullPath)<br/> 
					#else
						#set($remoteVersions = $!converter.getListFromArray($!deviatingContent.remoteVersion.versions))
						#set($localVersions = $!converter.getListFromArray($!deviatingContent.localVersion.versions))
						
						#if($remoteVersions.size() > 0)
							#set($value1 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($!remoteVersions.get(0), 'iglb'))")
						#else
							#set($value1 = "")
						#end
						
						#if($localVersions.size() > 0)
							#set($value2 = "$!formatter.escapeExtendedHTML($!formatter.cleanForJavascriptStrings($localVersions.get(0), 'iglb'))")
						#else
							#set($value2 = "")
						#end
						
						#*
						#if("$value1" == "$value2")
							$deviatingContent.remoteVersion.name is same as remote<br/>
						#end
						*#
						
						#if("$value1" != "$value2")
							<input type="checkbox" name="deviatingContentName" value="$deviatingContent.remoteVersion.name"/> $deviatingContent.remoteVersion.name - <a href="javascript:showDiff($deviatingContent.remoteVersion.id);">diff</a><br/>
							<script type="text/javascript">
							<!--
							var value1 = "$value1";
							var value2 = "$value2";
							value1 = value1.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
							value2 = value2.replace(/iglb/g, "<br/>").replace(/CDATA\[/g, "CDATA[<br/>");
							
							document.write("<div id='$deviatingContent.remoteVersion.id' style='display:none; background-color: #FFF; border: 1px solid #333; padding: 5px;'>" + diffString(value2, value1) + "</div>");
							-->
							</script>
						#else
							##Exakt compare: $deviatingContent.remoteVersion.name<br/> 
						#end
					#end
			
					#set($indexMissingContents = $indexMissingContents + 1)
				#end
				#if($deviatingContents.size() == 0)
					<li class="normalitem">No missing contents</li>
				#end
				<br/>
				<input type="image" src="$ui.getString("images.contenttool.buttons.next")" width="50" height="25">
			</form>
		#end
		
	</div>
</div>
<p/>	
</div>
</body>
</html>
