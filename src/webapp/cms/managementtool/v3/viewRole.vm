<?xml version="1.0" encoding="UTF-8"?> 

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

#beginManagementToolV3("tool.managementtool.viewRole.header" "tool.managementtool.viewRole.header" "roleName=$formatter.encodeURI($roleName)")

<SCRIPT type="text/javascript" SRC="script/OptionTransfer.js"></SCRIPT>

<script type="text/javascript" src="script/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script type="text/javascript" src="script/yui/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="script/yui/build/button/button-min.js"></script>

<script type="text/javascript">

	$(document).ready(function(){
		$(":input:first").focus();

 		$("div").each(function(i,e){
 			$(this).attr("tabindex", "-1");
		}); 
 	});
	
    YAHOO.example.init = function () 
    {
        YAHOO.util.Event.onContentReady("buttons", function () 
        {
			var oSaveButton = new YAHOO.widget.Button("saveButton");
			var oSaveAndExitButton = new YAHOO.widget.Button("saveAndExitButton");
			var oCancelButton = new YAHOO.widget.Button("cancelButton");

			var oRightButton = new YAHOO.widget.Button("transferRightButton");
			var oLeftButton = new YAHOO.widget.Button("transferLeftButton");

        	oSaveButton.on("click", function (p_oEvent){
        		save(document.inputForm);
        	});
        	oCancelButton.on("click", function (p_oEvent){
        		document.location.href = 'ViewListRole!listManagableRoles.action';
        	});
			
        	oRightButton.on("click", function (p_oEvent){
	   			!$('#unassignedUserNameList option:selected').remove().appendTo('#userName');  
        	});
        	oLeftButton.on("click", function (p_oEvent){
				!$('#userName option:selected').remove().appendTo('#unassignedUserNameList');  
        	});
        });
    }();

</script>

<SCRIPT LANGUAGE="JavaScript">

	var opt = new OptionTransfer("unassignedUserNameList","userName");
	opt.setAutoSort(true);
	opt.setDelimiter(",");
	opt.saveRemovedLeftOptions("removedLeft");
	opt.saveRemovedRightOptions("removedRight");
	opt.saveAddedLeftOptions("addedLeft");
	opt.saveAddedRightOptions("addedRight");
	opt.saveNewLeftOptions("newLeft");
	opt.saveNewRightOptions("newRight");
	
	function markNearestOption()
	{
		var searchField = document.getElementById("searchField");
		var list        = document.getElementById("unassignedUserNameList");
		//alert("list:" + list);
		
	  	sNode = list.options;
	  	for(i=0;i<sNode.length;i++)
		{
			currentNode = sNode[i];
			//alert("currentNode:" + currentNode.text);
			//alert("searchField:" + searchField.value);
			//alert("index:" + currentNode.text.indexOf(searchField.value));
			if(currentNode.text.toLowerCase().indexOf(searchField.value.toLowerCase()) > -1)
			{
				list.selectedIndex = i;
			  	break;		
			}
	  	}
	}
	
	function save(form)
	{
		var list = document.getElementById("userName");
		
	  	sNode = list.options;
	  	for(i=0;i<sNode.length;i++)
		{
			currentNode = sNode[i];
			//alert("CurrentNode:" + currentNode);
			//alert("currentNode:" + currentNode.name);
			//alert("CurrentNode:" + currentNode.selected);
			currentNode.selected = true;
		}
		form.submit();
	}

	function saveAndExit(form, action)
	{
		form.action = action;
		save(form);
	}

</SCRIPT>

<style type="text/css">

#set($buttons = $this.getToolbarButtons("tool.managementtool.viewRole.header", "$roleName", ""))

#foreach($button in $buttons)
	.yui-button#button$velocityCount button {
	    background: url($button.backgroundImageURL) 2px 6px no-repeat;
	    text-indent: 20px;
	    padding: 6px;
	    min-width: 50px;
	    amax-width: 100px;
	    border: 0px;
	    height: 28px;
	}
#end
</style>
<style>
	
	.yui-skin-sam .yui-button {
		border-width: 1px 0;
		border-style: solid;
		border-color: #808080;
		background: url(script/yui/assets/skins/sam/sprite.png) repeat-x 0 0;
		margin: auto .25em;
	}
	
	.yui-skin-sam .yui-button .first-child {
		border-width: 0 1px;
		border-style: solid;
		border-color: #808080;
		margin: 0 -1px; *
		position: relative; *
		left: -1px;
	}

	.yui-skin-sam .yui-button-hover {
		border-color: #7D98B8;
		background-position: 0 -1300px;
	}
	
	.yui-skin-sam .yui-button-hover .first-child {
		border-color: #7D98B8;
	}
</style>

<script type="text/javascript">

    YAHOO.example.init = function () 
    {
        YAHOO.util.Event.onContentReady("menutoolbar", function () 
        {
			#foreach($button in $buttons)
				var oButton${velocityCount} = new YAHOO.widget.Button("button${velocityCount}");
            	oButton${velocityCount}.on("click", function (p_oEvent){
            		document.location.href = '$button.actionURL';
            	});
            #end
        });
    }();

</script>

<div id="menutoolbar">
#foreach($button in $buttons)
	<input type="button" id="button$velocityCount" name="button$velocityCount" value="$button.text" title="$button.title"/>
#end
</div>

<div style="clear: both;"></div>

#if($supportsUpdate == false)
	#set($readonly = "disabled")
#else
	#set($readonly = "")
#end
#set($hasAccessToManageUsers = $this.hasAccessTo("Role.ManageUsers", "$roleName"))

<div id="igEditArea">

<form id="inputForm" name="inputForm" method="POST" action="UpdateRole.action">
<input type="hidden" name="roleName" value="$!roleName">

		<fieldset class="ig-fieldset">
			<!--<legend class="ig-legend">$ui.getString("tool.managementtool.createRole.header")</legend>-->
			#editTextFieldCSS("Role.name" "roleName" "$!roleName" "51" true)
			#editTextFieldCSS("Role.description" "description" "$!description" "51" true)

			#labelCSS("tool.managementtool.roleManageMemebers.label" "ig-section-label")
			
			<div>
				<table cellpadding="0" cellspacing="0">
					<tr>
					  <td>
						<table width="100%" border="0" cellpadding="0" cellspacing="2">
						  <tr>
						    <td>State a name or choose from list:<br>
						        <input type="text" id="searchField" name="searchField" class="ig-textfield" style="width:300px;" onkeypress="javascript:markNearestOption();" onchange="javascript:markNearestOption();">
						      </td>
						    <td>&nbsp;</td>
						    <td valign="bottom">Members</td>
						  </tr>
						  <tr>
						    <td>
						    	<select class="ig-select" id="unassignedUserNameList" name="unassignedUserNameList" MULTIPLE SIZE="10" style="width:300px;">
						          	#foreach ($infoGluePrincipal in $allInfoGluePrincipals)
										<option value="$infoGluePrincipal.name" title="$infoGluePrincipal.name">$infoGluePrincipal.name</option>
									#end
						        </select>
						    </td>
						    <td align="center">
						        <input id="transferRightButton" name="transferRightButton" type="button" name="right" value="&gt;&gt;" style="width:50px; font-family: verdana; font-size: 10px;"><BR><BR>
								<input id="transferLeftButton" name="transferLeftButton" type="button" name="left" value="&lt;&lt;" style="width:50px; font-family: verdana; font-size: 10px;"><BR><BR>
							</td>
						    <td>
						      	<select class="ig-select" id="userName" name="userName" multiple size="10" style="width:300px;">
									#foreach ($assignedInfoGluePrincipal in $assignedInfoGluePrincipals)
										<option value="$assignedInfoGluePrincipal.name" title="$assignedInfoGluePrincipal.name">$assignedInfoGluePrincipal.name</option>
									#end
							    </select>
						    </td>
						</tr>
						</table>
						</td>
					</tr>
				</table>
			</div>
						
			<div class="ig-row">
				<label class="ig-label-nl" for="contentTypeDefinitionId">$ui.getString("tool.managementtool.roleContentTypeDefinition.label")</label>
				<select name="contentTypeDefinitionId" class="ig-select">
					<option value="">Choose type</option>
					#foreach ($contentTypeDefinitionVO in $contentTypeDefinitionVOList)
						#set($selected = "")
						#foreach ($assignedContentTypeDefinitionVO in $assignedContentTypeDefinitionVOList)
							#if($assignedContentTypeDefinitionVO.id == $contentTypeDefinitionVO.id)
								#set($selected = "selected")
							#end 
						#end
						<option value="$contentTypeDefinitionVO.id" $selected>$contentTypeDefinitionVO.getName()</option>
					#end
				</select>
			</div>
			
			<div id="buttons" class="ig-buttonRow">
				<input type="button" id="saveButton" name="saveButton" value="Save" title="Save"/>
				<input type="button" id="saveAndExitButton" name="saveAndExitButton" value="Save and exit" title="Save and exit to list again"/>
				<input type="button" id="cancelButton" name="cancelButton" value="Cancel" title="Cancel"/>
			</div>
		</fieldset>

#*
<table>
	<tr>
		<td>#editReadOnlyField("Role.name" "newUserName" $!roleName "51" "disabled")</td>
	</tr>	
		
	<tr>
		<td width="400">#editReadOnlyTextArea("Role.description" "description" $!description "50" "5" "normaltextarea" $readonly)</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>
	
	<tr>
		<td class="biglabel">Manage the members in this role below</td>
	</tr>
	<tr>
	  <td>
		<table width="100%" border="0">
		  <tr>
		    <td>State a name or choose from list:<br>
		        <input type="text" id="searchField" name="searchField" style="font-size: 10px; width:200px;"/ onkeypress="javascript:markNearestOption();" onchange="javascript:markNearestOption();" $readonly>
		      </td>
		    <td>&nbsp;</td>
		    <td valign="bottom">Current Members</td>
		  </tr>
		  <tr>
		    <td>
		    	<SELECT $readonly id="unassignedUserNameList" NAME="unassignedUserNameList" MULTIPLE SIZE="10" #if($hasAccessToManageUsers)onDblClick="opt.transferRight()"#end style="font-size: 10px; width:300px;">
					#if($supportsUpdate)
						#if($hasAccessToManageUsers)
				          	#foreach ($infoGluePrincipal in $allInfoGluePrincipals)
								#set($checked = "")
								#foreach ($assignedInfoGluePrincipal in $assignedInfoGluePrincipals)
									#if($assignedInfoGluePrincipal.getName() == $infoGluePrincipal.getName())
										#set($checked = "checked")
									#end 
								#end
								
								#if($checked == "")
									<option value="$infoGluePrincipal.name" title="$infoGluePrincipal.name">$infoGluePrincipal.name</option>
								#end
							#end
						#else
							<option value="" title="You are not allowed to assign users">You are not allowed to assign users</option>
						#end
					#else
						<option value="" title="No need to show users">No need to show users</option>
					#end
		        </select>
		    </td>
		    <td align="center">
		        <INPUT TYPE="button" NAME="right" VALUE="&gt;&gt;" ONCLICK="opt.transferRight()" style="width:50px; font-family: verdana; font-size: 10px;"><BR><BR>
				<INPUT TYPE="button" NAME="right" VALUE="All &gt;&gt;" ONCLICK="opt.transferAllRight()" style="width:50px; font-family: verdana; font-size: 10px;"><BR><BR>
				<INPUT TYPE="button" NAME="left" VALUE="&lt;&lt;" ONCLICK="opt.transferLeft()" style="width:50px; font-family: verdana; font-size: 10px;"><BR><BR>
				<INPUT TYPE="button" NAME="left" VALUE="All &lt;&lt;" ONCLICK="opt.transferAllLeft()" style="width:50px; font-family: verdana; font-size: 10px;">
		    </td>
		    <td>
		      	<SELECT $readonly id="userName" name="userName" multiple size="10" #if($hasAccessToManageUsers)onDblClick="opt.transferLeft()"#end style="font-size: 10px; width:300px;">
		        	#foreach ($assignedInfoGluePrincipal in $assignedInfoGluePrincipals)
						<option value="$assignedInfoGluePrincipal.name" title="$assignedInfoGluePrincipal.name">$assignedInfoGluePrincipal.name</option>
					#end
			    </select>
		    </td>
		</tr>
		</table>
		</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td class="biglabel">Base role properties on content type definition</td>
	</tr>
	<tr>
		<td>	
			<select name="contentTypeDefinitionId">
				<option value="">Choose type</option>
				#foreach ($contentTypeDefinitionVO in $contentTypeDefinitionVOList)
					#set($selected = "")
					#foreach ($assignedContentTypeDefinitionVO in $assignedContentTypeDefinitionVOList)
						#if($assignedContentTypeDefinitionVO.id == $contentTypeDefinitionVO.id)
							#set($selected = "selected")
						#end 
					#end
					<option value="$contentTypeDefinitionVO.id" $selected>$contentTypeDefinitionVO.getName()</option>
				#end
			</select>
		</td>
	</tr>
	##if($supportsUpdate)
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td>
			<a href="javascript:save(document.editForm);"><img src="$ui.getString("images.managementtool.buttons.save")" width="50" height="25" border="0" onClick='JavaScript:showWorking();'></a>
			<a href="javascript:saveAndExit(document.editForm, 'UpdateRole!saveAndExit.action');"><img src="$ui.getString("images.managementtool.buttons.saveAndExit")" width="80" height="25" border="0"></a>
			<a href="ViewListRole.action"><img border="0" src="$ui.getString("images.managementtool.buttons.cancel")" width="50" height="25"></a>
		</td>
	</tr>
	##end
</table>
*#

</form>
</div>

<script type="text/javascript">
	//alert("Initializing form..");
	opt.init(document.editForm);
</script>

</body>
</html>
