<?xml version="1.0" encoding="UTF-8"?> 
 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

#beginStructureTool("tool.structuretool.publishSiteNode.header" "tool.structuretool.publishSiteNode.header" "" "0" "0" "0")

<script language="JavaScript">
<!--
		function checkMarkedVersions()
		{
			var listForm = document.listForm;
			var lengthsel = null;
			var lengthsit = null;
			var ret = 0;
			if (listForm.sel != null)
				lengthsel = listForm.sel.length;
			if (listForm.sit != null)
				lengthsit = listForm.sit.length;

			if (lengthsel == null && listForm.sel != null)
		  	{
		  		if (listForm.sel.checked)
			    	ret++;
		  	}
			else
			{
			  	for (i=0; i<lengthsel; i++)
			   		if (listForm.sel[i].checked)
			    		ret++;
			}
			    		
			if (lengthsit == null && listForm.sit != null)
		  	{
		  		if (listForm.sit.checked)
			    	ret++;
		  	}
		  	else
		  	{
			  	for (i=0; i<lengthsit; i++)
			   		if (listForm.sit[i].checked)
			    		ret++;
			}
		    		
			return ret;
		}
		
		function checkAll()
		{
		 	var field = document.listForm.sel;
		 	for (i = 0; i < field.length; i++)
				field[i].checked = true ;
		}
		
		function uncheckAll()
		{
			var field = document.listForm.sel;
			for (i = 0; i < field.length; i++)
				field[i].checked = false ;
		}
		
		function submitToPublish(attemptDirectPublishing)
		{
			var listForm = document.listForm;
			var commentElm = document.getElementById("xversionComment");
			if (checkMarkedVersions() == 0)
			{
				alert('Select one or more versions to publish');
			  	return;
			}
			else
			{
				listForm.action = "ChangeMultiSiteNodeVersionStatePublish.action"
				listForm.versionComment.value = commentElm.value;
				listForm.attemptDirectPublishing.value = attemptDirectPublishing;
				listForm.submit();
			}
		}
-->
</script>

<div class="fullymarginalized">

<table width="95%" border="0">
<tr>
	<td>
		<table width="300" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td colspan="3" class="biglabel">$ui.getString("tool.structuretool.stateChangeComment")</td>
			</tr>		
			<tr>
				<td colspan="3"><img src="images/trans.gif" height="10" width="1"></td>
			</tr>
			<tr>
				<td colspan="3">#editTextArea("SiteNodeVersion.versionComment" "xversionComment" $!versionComment "10" "10" "normaltextarea")</td>
			</tr>		
		</table>
	</td>
	<td align="right" valign="top">
		<br><br><br>
		
		#if($this.hasAccessTo("PublishingTool.Read") && $this.hasAccessTo("Repository.Read", "$!repositoryId"))
		<a href="javascript:submitToPublish('true');">
		<img src="$ui.getString("images.contenttool.buttons.publish")" width="60" height="25" border="0">
		</a><br>
		#end
		
		<a href="javascript:submitToPublish('false');">
		<img src="$ui.getString("images.contenttool.buttons.submitToPublish")" width="60" height="25" border="0">
		</a><br>
		
		<a href="ViewSiteNode.action?siteNodeId=$siteNodeId&repositoryId=$!repositoryId">
		<img src="$ui.getString("images.contenttool.buttons.cancel60x25")" width="60" height="25" border="0">
		</a><br><br>
		
		#if($siteNodeVersions.size() > 1)
			<a href="javascript:checkAll();">
			<img src="$ui.getString("images.contenttool.buttons.checkAll60x25")" width="60" height="25" border="0">
			</a><br>
			
			<a href="javascript:uncheckAll();">
			<img src="$ui.getString("images.contenttool.buttons.uncheckAll60x25")" width="60" height="25" border="0">
			</a><br>
		#end
	</td>
</tr>
<tr>
	<td colspan="2">
		<br/><br/>
		The marked versions will be submitted for publishing.<br><br>
	</td>
</tr>
<tr>
	<td colspan="2">

#set($lvBorder = 0) 
#set($lvConstraint = -1) 
#lvHead(["Name", "Owner"] "Publish items" "" "" "")

#hiddenField("siteNodeId" $siteNodeId)
#hiddenField("siteNodeVersionId" $siteNodeVersionId)
#hiddenField("versionComment" $!versionComment)
#hiddenField("attemptDirectPublishing" $!attemptDirectPublishing)

#set($cnt = 0)
#foreach($cv in $siteNodeVersions)

	#set( $row = ["$cv.getId() - $cv.getSiteNodeName()", ""] )
	#set($cnt = $cnt + 1)
	#lvAddRow($row $cnt $cv.getId())

#end



#lvEnd()
</td>
</tr>
</table>
	
</div>

#endStructureTool()

